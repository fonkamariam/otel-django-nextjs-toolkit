# prometheus.yml
# Configuration for Prometheus – metrics time-series storage
# Scrapes metrics from OTEL Collector (:8889), cAdvisor, node_exporter, etc.
# Most settings are safe defaults; override via env vars where noted

global:
  scrape_interval: 15s          # How often to scrape targets (default 15s)
  evaluation_interval: 15s        # How often to evaluate rules (default 15s)
  scrape_timeout: 10s            # Timeout for each scrape
  
  storage:
    tsdb:
      min_block_duration: 15m     # Minimum block duration for time-series data (default 15m)
      max_block_duration: 60m    # Maximum block duration (default 60m)
      retention: 3d             # How long to retain data (default 15d)

# Alerting (optional – add Alertmanager later if needed)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['alertmanager:9093']

rule_files:
  # - "first_rules.yml"  # ← Add your own alerting rules here later if needed

scrape_configs:
  # OTEL Collector metrics (exposed on :8889)
  - job_name: otel-collector
    static_configs:
      - targets: ['otel-collector:8889']                      # Where collector exposes Prometheus metrics

  # cAdvisor – container metrics
  - job_name: cadvisor
    static_configs:
      - targets: ['cadvisor:8080']                            # cAdvisor UI/metrics endpoint

  # node_exporter – host metrics
  - job_name: node_exporter
    static_configs:
      - targets: ['node_exporter:9100']                       # Host OS metrics

  # Optional: Add your own app metrics if they expose /metrics (rare with OTEL push)
  # - job_name: my-django-app
  #   static_configs:
  #     - targets: ['django:8000']  # if you add prometheus endpoint in Django

  # Optional: scrape Grafana itself for its own metrics
  
  - job_name: grafana
    static_configs:
      - targets: ['grafana:3000']